# ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

## ğŸ“‹ æ¦‚è¿°

ç‰©æµé…é€ç®¡ç†ç³»ç»Ÿé‡‡ç”¨MySQL 8.0ä½œä¸ºä¸»æ•°æ®åº“ï¼Œä½¿ç”¨utf8mb4å­—ç¬¦é›†ï¼Œæ”¯æŒå®Œæ•´çš„Unicodeå­—ç¬¦ã€‚æ•°æ®åº“è®¾è®¡éµå¾ªç¬¬ä¸‰èŒƒå¼ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚

## ğŸ—ï¸ æ•°æ®åº“æ¶æ„

### æ•°æ®åº“ä¿¡æ¯
- **æ•°æ®åº“åç§°**: `logistics_db`
- **å­—ç¬¦é›†**: `utf8mb4`
- **æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`
- **å­˜å‚¨å¼•æ“**: `InnoDB`
- **æ—¶åŒº**: `+08:00` (åŒ—äº¬æ—¶é—´)

### è¡¨å‘½åè§„èŒƒ
- æ‰€æœ‰è¡¨åä»¥ `t_` å¼€å¤´
- ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯
- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼
- ä¾‹å¦‚: `t_users`, `t_customers`, `t_receipts`

## ğŸ“Š æ•°æ®è¡¨è®¾è®¡

### 1. ç”¨æˆ·è¡¨ (t_users)
ç®¡ç†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·ã€‚

```sql
CREATE TABLE `t_users` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `nickname` varchar(100) DEFAULT NULL COMMENT 'æ˜µç§°',
  `password` varchar(255) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†ï¼‰',
  `role_id` bigint DEFAULT NULL COMMENT 'è§’è‰²ID',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_is_deleted` (`is_deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è¡¨';
```

### 2. è§’è‰²è¡¨ (t_roles)
å®šä¹‰ç³»ç»Ÿä¸­çš„å„ç§è§’è‰²ã€‚

```sql
CREATE TABLE `t_roles` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'è§’è‰²ID',
  `name` varchar(50) NOT NULL COMMENT 'è§’è‰²åç§°',
  `description` varchar(200) DEFAULT NULL COMMENT 'è§’è‰²æè¿°',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`),
  KEY `idx_is_deleted` (`is_deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è§’è‰²è¡¨';
```

### 3. æƒé™è¡¨ (t_permissions)
å®šä¹‰ç³»ç»Ÿä¸­çš„å„ç§æƒé™ã€‚

```sql
CREATE TABLE `t_permissions` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æƒé™ID',
  `name` varchar(100) NOT NULL COMMENT 'æƒé™åç§°',
  `code` varchar(100) NOT NULL COMMENT 'æƒé™ä»£ç ',
  `description` varchar(200) DEFAULT NULL COMMENT 'æƒé™æè¿°',
  `resource` varchar(100) DEFAULT NULL COMMENT 'èµ„æºæ ‡è¯†',
  `action` varchar(50) DEFAULT NULL COMMENT 'æ“ä½œç±»å‹',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  KEY `idx_resource` (`resource`),
  KEY `idx_is_deleted` (`is_deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æƒé™è¡¨';
```

### 4. è§’è‰²æƒé™å…³è”è¡¨ (t_role_permissions)
è§’è‰²å’Œæƒé™çš„å¤šå¯¹å¤šå…³è”è¡¨ã€‚

```sql
CREATE TABLE `t_role_permissions` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `role_id` bigint NOT NULL COMMENT 'è§’è‰²ID',
  `permission_id` bigint NOT NULL COMMENT 'æƒé™ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_permission` (`role_id`,`permission_id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_permission_id` (`permission_id`),
  CONSTRAINT `fk_role_permissions_role` FOREIGN KEY (`role_id`) REFERENCES `t_roles` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_role_permissions_permission` FOREIGN KEY (`permission_id`) REFERENCES `t_permissions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è§’è‰²æƒé™å…³è”è¡¨';
```

### 5. å®¢æˆ·è¡¨ (t_customers)
å­˜å‚¨å®¢æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯å’Œåœ°å€ä¿¡æ¯ã€‚

```sql
CREATE TABLE `t_customers` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'å®¢æˆ·ID',
  `customer_number` varchar(50) NOT NULL COMMENT 'å®¢æˆ·ç¼–å·',
  `customer_name` varchar(200) NOT NULL COMMENT 'å®¢æˆ·åç§°',
  `contact_person` varchar(100) DEFAULT NULL COMMENT 'è”ç³»äºº',
  `contact_phone` varchar(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
  `store_address` text COMMENT 'é—¨åº—åœ°å€',
  `warehouse_address` text COMMENT 'ä»“åº“åœ°å€',
  `detail_address` text COMMENT 'è¯¦ç»†åœ°å€',
  `longitude` decimal(10,7) DEFAULT NULL COMMENT 'ç»åº¦',
  `latitude` decimal(10,7) DEFAULT NULL COMMENT 'çº¬åº¦',
  `update_by` bigint DEFAULT NULL COMMENT 'æ›´æ–°äººID',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_customer_number` (`customer_number`),
  KEY `idx_customer_name` (`customer_name`),
  KEY `idx_update_time` (`update_time`),
  KEY `idx_is_deleted` (`is_deleted`),
  KEY `idx_update_by` (`update_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å®¢æˆ·è¡¨';
```

### 6. å°ç¨‹åºç”¨æˆ·è¡¨ (t_wx_users)
å­˜å‚¨å°ç¨‹åºç”¨æˆ·ä¿¡æ¯ï¼Œä¸»è¦æ˜¯å¸æœºå’Œé”€å”®äººå‘˜ã€‚

```sql
CREATE TABLE `t_wx_users` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'å°ç¨‹åºç”¨æˆ·ID',
  `name` varchar(100) NOT NULL COMMENT 'å§“å',
  `phone` varchar(20) NOT NULL COMMENT 'æ‰‹æœºå·',
  `role` enum('driver','sales') NOT NULL COMMENT 'è§’è‰²ï¼šdriver-å¸æœºï¼Œsales-é”€å”®',
  `wechat_id` varchar(100) DEFAULT NULL COMMENT 'å¾®ä¿¡openid',
  `mac_address` varchar(50) DEFAULT NULL COMMENT 'MACåœ°å€',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`),
  UNIQUE KEY `uk_wechat_id` (`wechat_id`),
  KEY `idx_role` (`role`),
  KEY `idx_is_deleted` (`is_deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å°ç¨‹åºç”¨æˆ·è¡¨';
```

### 7. ç­¾æ”¶å•è¡¨ (t_receipts)
å­˜å‚¨ç­¾æ”¶å•ä¿¡æ¯å’Œå›¾ç‰‡è·¯å¾„ã€‚

```sql
CREATE TABLE `t_receipts` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç­¾æ”¶å•ID',
  `wx_user_id` bigint NOT NULL COMMENT 'å°ç¨‹åºç”¨æˆ·ID',
  `wx_user_name` varchar(100) NOT NULL COMMENT 'ä¸Šä¼ äººå§“å',
  `customer_id` bigint DEFAULT NULL COMMENT 'å®¢æˆ·ID',
  `customer_name` varchar(200) NOT NULL COMMENT 'å®¢æˆ·åç§°',
  `customer_address` text COMMENT 'å®¢æˆ·åœ°å€',
  `upload_location` varchar(500) DEFAULT NULL COMMENT 'ä¸Šä¼ åœ°ç‚¹',
  `upload_longitude` decimal(10,7) DEFAULT NULL COMMENT 'ä¸Šä¼ ç»åº¦',
  `upload_latitude` decimal(10,7) DEFAULT NULL COMMENT 'ä¸Šä¼ çº¬åº¦',
  `image_path` varchar(500) NOT NULL COMMENT 'å›¾ç‰‡è·¯å¾„',
  `image_url` varchar(500) NOT NULL COMMENT 'å›¾ç‰‡è®¿é—®URL',
  `upload_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸Šä¼ æ—¶é—´',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_wx_user_id` (`wx_user_id`),
  KEY `idx_customer_id` (`customer_id`),
  KEY `idx_upload_time` (`upload_time`),
  KEY `idx_is_deleted` (`is_deleted`),
  CONSTRAINT `fk_receipts_wx_user` FOREIGN KEY (`wx_user_id`) REFERENCES `t_wx_users` (`id`),
  CONSTRAINT `fk_receipts_customer` FOREIGN KEY (`customer_id`) REFERENCES `t_customers` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç­¾æ”¶å•è¡¨';
```

## ğŸ”— è¡¨å…³ç³»è®¾è®¡

### ERå›¾å…³ç³»
```
t_users â”€â”€â”
          â”œâ”€â”€ t_roles â”€â”€â”€â”€ t_role_permissions â”€â”€â”€â”€ t_permissions
          â”‚
          â””â”€â”€ t_customers (update_by)

t_wx_users â”€â”€â”€â”€ t_receipts â”€â”€â”€â”€ t_customers
```

### ä¸»è¦å…³è”å…³ç³»
1. **ç”¨æˆ·-è§’è‰²**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªè§’è‰²
2. **è§’è‰²-æƒé™**: å¤šå¯¹å¤šå…³ç³»ï¼Œé€šè¿‡ä¸­é—´è¡¨å…³è”
3. **å°ç¨‹åºç”¨æˆ·-ç­¾æ”¶å•**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥ä¸Šä¼ å¤šä¸ªç­¾æ”¶å•
4. **å®¢æˆ·-ç­¾æ”¶å•**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå®¢æˆ·å¯ä»¥æœ‰å¤šä¸ªç­¾æ”¶å•
5. **ç”¨æˆ·-å®¢æˆ·**: é€šè¿‡update_byå­—æ®µè®°å½•å®¢æˆ·ä¿¡æ¯çš„æ›´æ–°äºº

## ğŸ“ˆ ç´¢å¼•è®¾è®¡

### ä¸»é”®ç´¢å¼•
æ‰€æœ‰è¡¨éƒ½ä½¿ç”¨è‡ªå¢çš„bigintç±»å‹ä¸»é”®ï¼Œç¡®ä¿é«˜æ€§èƒ½å’Œå”¯ä¸€æ€§ã€‚

### å”¯ä¸€ç´¢å¼•
- `t_users.username`: ç”¨æˆ·åå”¯ä¸€
- `t_roles.name`: è§’è‰²åå”¯ä¸€
- `t_permissions.code`: æƒé™ä»£ç å”¯ä¸€
- `t_customers.customer_number`: å®¢æˆ·ç¼–å·å”¯ä¸€
- `t_wx_users.phone`: æ‰‹æœºå·å”¯ä¸€
- `t_wx_users.wechat_id`: å¾®ä¿¡IDå”¯ä¸€

### æ™®é€šç´¢å¼•
- è½¯åˆ é™¤å­—æ®µ `is_deleted`
- æ—¶é—´å­—æ®µ `create_time`, `update_time`, `upload_time`
- å¤–é”®å­—æ®µ `role_id`, `wx_user_id`, `customer_id`
- æœç´¢å­—æ®µ `customer_name`, `role`

## ğŸ”’ æ•°æ®å®Œæ•´æ€§

### å¤–é”®çº¦æŸ
- è§’è‰²æƒé™å…³è”è¡¨çš„å¤–é”®çº¦æŸï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- ç­¾æ”¶å•è¡¨çš„å¤–é”®çº¦æŸï¼Œå…³è”ç”¨æˆ·å’Œå®¢æˆ·

### å­—æ®µçº¦æŸ
- NOT NULLçº¦æŸï¼šå…³é”®å­—æ®µä¸å…è®¸ä¸ºç©º
- æšä¸¾çº¦æŸï¼šè§’è‰²å­—æ®µä½¿ç”¨ENUMç±»å‹é™åˆ¶å–å€¼
- é•¿åº¦çº¦æŸï¼šå­—ç¬¦ä¸²å­—æ®µè®¾ç½®åˆç†çš„é•¿åº¦é™åˆ¶

### è½¯åˆ é™¤è®¾è®¡
æ‰€æœ‰ä¸šåŠ¡è¡¨éƒ½é‡‡ç”¨è½¯åˆ é™¤æœºåˆ¶ï¼š
- ä½¿ç”¨ `is_deleted` å­—æ®µæ ‡è®°åˆ é™¤çŠ¶æ€
- 0è¡¨ç¤ºæœªåˆ é™¤ï¼Œ1è¡¨ç¤ºå·²åˆ é™¤
- æŸ¥è¯¢æ—¶éœ€è¦è¿‡æ»¤å·²åˆ é™¤çš„è®°å½•

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### åˆ†åŒºç­–ç•¥
å¯¹äºå¤§æ•°æ®é‡çš„è¡¨ï¼ˆå¦‚ç­¾æ”¶å•è¡¨ï¼‰ï¼Œå¯ä»¥è€ƒè™‘æŒ‰æ—¶é—´åˆ†åŒºï¼š
```sql
-- æŒ‰æœˆåˆ†åŒºç¤ºä¾‹
PARTITION BY RANGE (YEAR(upload_time) * 100 + MONTH(upload_time)) (
  PARTITION p202501 VALUES LESS THAN (202502),
  PARTITION p202502 VALUES LESS THAN (202503),
  ...
);
```

### æŸ¥è¯¢ä¼˜åŒ–
- åˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ
- åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨LIMITå’ŒOFFSET
- å¤æ‚æŸ¥è¯¢ä½¿ç”¨é€‚å½“çš„JOINç±»å‹
- å®šæœŸåˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢

### å­˜å‚¨ä¼˜åŒ–
- é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- å¤§æ–‡æœ¬å­—æ®µä½¿ç”¨TEXTç±»å‹
- åæ ‡å­—æ®µä½¿ç”¨DECIMALç±»å‹ä¿è¯ç²¾åº¦

## ğŸ“Š æ•°æ®åˆå§‹åŒ–

### ç³»ç»Ÿç®¡ç†å‘˜
```sql
INSERT INTO t_users (username, nickname, password, role_id) 
VALUES ('admin', 'ç³»ç»Ÿç®¡ç†å‘˜', '$2b$10$encrypted_password', 1);
```

### é»˜è®¤è§’è‰²å’Œæƒé™
```sql
-- è¶…çº§ç®¡ç†å‘˜è§’è‰²
INSERT INTO t_roles (name, description) 
VALUES ('è¶…çº§ç®¡ç†å‘˜', 'æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™');

-- åŸºç¡€æƒé™
INSERT INTO t_permissions (name, code, description, resource, action) VALUES
('æŸ¥çœ‹ç”¨æˆ·', 'user:view', 'æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨å’Œè¯¦æƒ…', 'user', 'view'),
('åˆ›å»ºç”¨æˆ·', 'user:create', 'åˆ›å»ºæ–°ç”¨æˆ·', 'user', 'create'),
('ç¼–è¾‘ç”¨æˆ·', 'user:update', 'ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯', 'user', 'update'),
('åˆ é™¤ç”¨æˆ·', 'user:delete', 'åˆ é™¤ç”¨æˆ·', 'user', 'delete');
```

---

**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹ [APIæ¥å£è®¾è®¡](./APIæ¥å£è®¾è®¡.md) äº†è§£è¯¦ç»†çš„æ¥å£è®¾è®¡è§„èŒƒã€‚
