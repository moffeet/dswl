# 🏗️ 系统架构概览

## 📋 项目简介

物流配送管理系统是一个基于现代Web技术栈构建的企业级物流配送管理解决方案，包含后端服务、管理后台和小程序前端三个核心模块。

## 🎯 系统目标

- **高效管理**: 提供完整的客户信息管理和配送记录管理
- **移动优先**: 支持小程序端的移动办公和实时数据上传
- **安全可靠**: 完善的权限控制和数据安全保障
- **易于维护**: 模块化设计，便于扩展和维护

## 🏛️ 整体架构

### 架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   小程序前端     │    │   管理后台       │    │   后端API       │
│  (Next.js 15)   │    │  (Next.js 15)   │    │   (NestJS 10)   │
│   端口: 3002     │    │   端口: 3001     │    │   端口: 3000     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                │
                    ┌─────────────────┐
                    │   MySQL 8.0     │
                    │   (数据存储)     │
                    └─────────────────┘
```

### 技术栈选择

#### 后端服务 (backend-node)
- **框架**: NestJS 10.x + TypeScript 5.x
  - 企业级Node.js框架，支持依赖注入和模块化
  - 内置支持TypeScript，提供强类型检查
  - 装饰器模式，代码简洁易维护
- **数据库**: MySQL 8.0 + TypeORM 0.3.x
  - 成熟稳定的关系型数据库
  - TypeORM提供强大的ORM功能
- **认证**: JWT + bcrypt + CASL权限控制
  - JWT无状态认证，支持分布式部署
  - bcrypt安全密码加密
  - CASL细粒度权限控制
- **API文档**: Swagger/OpenAPI 3.0
  - 自动生成API文档
  - 支持在线测试
- **文件上传**: Multer + 本地存储
  - 支持多种文件格式
  - 本地存储，便于管理

#### 管理后台 (admin-frontend)
- **框架**: Next.js 15.3.4 + Turbopack
  - React全栈框架，支持SSR/SSG
  - Turbopack提供极速的开发体验
- **UI库**: Arco Design + TailwindCSS 3.x
  - 企业级UI组件库
  - 原子化CSS，高度可定制
- **状态管理**: React Hooks + Axios
  - 轻量级状态管理
  - 统一的HTTP请求处理
- **表单**: React Hook Form
  - 高性能表单处理
  - 内置验证功能

#### 小程序前端 (frontend)
- **框架**: Next.js 15.3.4 + 响应式设计
  - 统一的技术栈，降低维护成本
  - 响应式设计，适配多种设备
- **地图**: 高德地图 Web API
  - 精确的地理位置服务
  - 路线规划功能
- **多媒体**: Web API (相机 + 地理位置)
  - 原生Web API，无需额外依赖
  - 支持拍照和位置获取

## 📂 项目结构

```
dswl1/
├── backend-node/           # NestJS 后端服务 (端口 3000)
│   ├── src/
│   │   ├── auth/          # 认证模块
│   │   ├── users/         # 用户管理
│   │   ├── roles/         # 角色管理
│   │   ├── permissions/   # 权限管理
│   │   ├── customers/     # 客户管理
│   │   ├── wx-users/      # 小程序用户
│   │   ├── receipts/      # 签收单管理
│   │   ├── miniprogram/   # 小程序接口
│   │   └── common/        # 公共模块
│   ├── uploads/           # 文件上传目录
│   └── logs/              # 日志文件
├── admin-frontend/         # Next.js 管理后台 (端口 3001)
│   ├── src/
│   │   ├── app/           # 页面组件
│   │   ├── components/    # 公共组件
│   │   ├── hooks/         # 自定义Hooks
│   │   ├── config/        # 配置文件
│   │   └── types/         # 类型定义
├── frontend/              # Next.js 小程序前端 (端口 3002)
│   ├── src/
│   │   ├── app/           # 页面组件
│   │   ├── components/    # 公共组件
│   │   └── utils/         # 工具函数
├── docs/                  # 文档目录
├── ser.sh                # 服务管理脚本
├── init.sql              # 数据库初始化脚本
├── logs/                 # 运行日志目录
└── pids/                 # 进程ID管理目录
```

## 🔄 数据流向

### 管理后台数据流
```
用户操作 → 前端组件 → API请求 → 后端控制器 → 服务层 → 数据库
                                    ↓
响应数据 ← 前端更新 ← API响应 ← 数据处理 ← 查询结果 ← 数据库
```

### 小程序数据流
```
小程序操作 → 签名校验 → API请求 → 后端验证 → 业务处理 → 数据库
                                      ↓
响应数据 ← 小程序更新 ← API响应 ← 数据封装 ← 处理结果 ← 数据库
```

## 🔐 安全架构

### 认证机制
- **管理后台**: JWT Token认证
- **小程序**: 签名校验 + Token认证
- **API保护**: 统一的认证守卫

### 权限控制
- **RBAC模型**: 用户-角色-权限三层模型
- **细粒度控制**: 页面级和操作级权限控制
- **动态权限**: 支持运行时权限检查

### 数据安全
- **密码加密**: bcrypt哈希加密
- **SQL注入防护**: TypeORM参数化查询
- **文件上传安全**: 文件类型和大小限制

## 📊 性能设计

### 数据库优化
- **索引设计**: 关键字段建立索引
- **查询优化**: 分页查询，避免全表扫描
- **连接池**: 数据库连接池管理

### 前端优化
- **代码分割**: Next.js自动代码分割
- **静态资源**: CDN加速（可选）
- **缓存策略**: 浏览器缓存和API缓存

### 后端优化
- **异步处理**: 文件上传等耗时操作异步处理
- **日志管理**: 结构化日志，便于监控
- **错误处理**: 统一的错误处理机制

## 🚀 部署架构

### 开发环境
- 本地开发，所有服务运行在localhost
- 热重载，快速开发调试

### 生产环境
- 云服务器部署
- 进程管理，自动重启
- 日志监控，性能监控

## 📈 扩展性设计

### 水平扩展
- 无状态设计，支持负载均衡
- 数据库读写分离（可选）
- 微服务架构（未来规划）

### 功能扩展
- 模块化设计，便于添加新功能
- 插件机制（未来规划）
- API版本控制

---

**下一步**: 查看 [数据库设计](./database-design.md) 了解详细的数据模型设计。
