# ğŸš€ éƒ¨ç½²å¯åŠ¨æŒ‡å—

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- **Node.js**: >= 18.18.0 (æ¨èä½¿ç”¨ v20.x)
- **MySQL**: >= 5.7 æˆ– 8.0+
- **npm**: >= 8.0.0
- **æ“ä½œç³»ç»Ÿ**: Linux/macOS/Windows

### ç¡¬ä»¶è¦æ±‚
- **å†…å­˜**: æœ€ä½ 2GBï¼Œæ¨è 4GB+
- **ç£ç›˜**: æœ€ä½ 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

## ğŸ› ï¸ å¿«é€Ÿéƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <é¡¹ç›®ä»“åº“åœ°å€>
cd dswl1
```

### 2. æ•°æ®åº“é…ç½®

#### åˆ›å»ºæ•°æ®åº“
```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS logistics_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'logistics_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON logistics_db.* TO 'logistics_user'@'localhost';
FLUSH PRIVILEGES;
```

#### å¯¼å…¥åˆå§‹åŒ–æ•°æ®
```bash
# å¯¼å…¥æ•°æ®åº“ç»“æ„å’Œåˆå§‹æ•°æ®
mysql -u root -p logistics_db < init.sql
```

### 3. ç¯å¢ƒé…ç½®

#### åç«¯ç¯å¢ƒé…ç½®
```bash
cd backend-node
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“é…ç½®
DATABASE_HOST=localhost
DATABASE_PORT=3306
DATABASE_USERNAME=root
DATABASE_PASSWORD=123456
DATABASE_NAME=logistics_db

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRES_IN=24h

# æœåŠ¡é…ç½®
PORT=3000
NODE_ENV=production

# å°ç¨‹åºç­¾åå¯†é’¥
MINIPROGRAM_SIGNATURE_KEY=miniprogram-signature-key-2024

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_MAX_SIZE=10485760
UPLOAD_ALLOWED_TYPES=jpg,jpeg,png,gif
```

#### å‰ç«¯ç¯å¢ƒé…ç½®
```bash
# ç®¡ç†åå°
cd admin-frontend
cp .env.example .env.local

# å°ç¨‹åºå‰ç«¯
cd ../frontend
cp .env.example .env.local
```

### 4. å®‰è£…ä¾èµ–
```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# å®‰è£…æ‰€æœ‰æ¨¡å—çš„ä¾èµ–
cd backend-node && npm install && cd ..
cd admin-frontend && npm install && cd ..
cd frontend && npm install && cd ..
```

### 5. å¯åŠ¨æœåŠ¡

#### ä½¿ç”¨æœåŠ¡ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
./ser.sh start all

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./ser.sh status

# æŸ¥çœ‹æ—¥å¿—
./ser.sh logs
```

#### æ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend-node
npm run start:prod &

# å¯åŠ¨ç®¡ç†åå°
cd ../admin-frontend
npm run build && npm run start &

# å¯åŠ¨å°ç¨‹åºå‰ç«¯
cd ../frontend
npm run build && npm run start &
```

## ğŸ”§ æœåŠ¡ç®¡ç†

### ser.sh è„šæœ¬ä½¿ç”¨

#### åŸºæœ¬å‘½ä»¤
```bash
./ser.sh                    # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./ser.sh status            # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./ser.sh logs              # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
```

#### å¯åŠ¨æœåŠ¡
```bash
./ser.sh start all         # å¯åŠ¨æ‰€æœ‰æœåŠ¡
./ser.sh start backend     # åªå¯åŠ¨åç«¯
./ser.sh start admin       # åªå¯åŠ¨ç®¡ç†åå°
./ser.sh start frontend    # åªå¯åŠ¨å°ç¨‹åºå‰ç«¯
```

#### åœæ­¢æœåŠ¡
```bash
./ser.sh stop all          # åœæ­¢æ‰€æœ‰æœåŠ¡
./ser.sh stop backend      # åªåœæ­¢åç«¯
./ser.sh stop admin        # åªåœæ­¢ç®¡ç†åå°
./ser.sh stop frontend     # åªåœæ­¢å°ç¨‹åºå‰ç«¯
```

#### é‡å¯æœåŠ¡
```bash
./ser.sh restart all       # é‡å¯æ‰€æœ‰æœåŠ¡
./ser.sh restart backend   # åªé‡å¯åç«¯
./ser.sh restart admin     # åªé‡å¯ç®¡ç†åå°
./ser.sh restart frontend  # åªé‡å¯å°ç¨‹åºå‰ç«¯
```

### æœåŠ¡ç«¯å£
- **åç«¯API**: http://localhost:3000
- **ç®¡ç†åå°**: http://localhost:3001
- **å°ç¨‹åºå‰ç«¯**: http://localhost:3002
- **APIæ–‡æ¡£**: http://localhost:3000/api

## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### äº‘æœåŠ¡å™¨é…ç½®

#### æœåŠ¡å™¨ä¿¡æ¯
- **IPåœ°å€**: 49.235.60.148
- **ç™»å½•æ–¹å¼**: å¯†é’¥ç™»å½•ï¼ˆæ— å¯†ç ï¼‰
- **é¡¹ç›®è·¯å¾„**: /szw/dswl1

#### éƒ¨ç½²æµç¨‹
```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh user@49.235.60.148

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /szw/dswl1

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 4. é‡å¯æœåŠ¡
./ser.sh restart all
```

### ç¯å¢ƒå˜é‡é…ç½®

#### ç”Ÿäº§ç¯å¢ƒ .env
```env
NODE_ENV=production
DATABASE_HOST=localhost
DATABASE_PORT=3306
DATABASE_USERNAME=root
DATABASE_PASSWORD=123456
DATABASE_NAME=logistics_db
JWT_SECRET=production-super-secret-jwt-key
PORT=3000
```

### è¿›ç¨‹ç®¡ç†

#### æŸ¥çœ‹è¿›ç¨‹
```bash
# æŸ¥çœ‹æ‰€æœ‰ç›¸å…³è¿›ç¨‹
ps aux | grep node

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep :3000
netstat -tlnp | grep :3001
netstat -tlnp | grep :3002
```

#### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/backend.log
tail -f logs/admin.log
tail -f logs/frontend.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/backend.log
```

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
./ser.sh status
```

### 2. æµ‹è¯•APIæ¥å£
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# æµ‹è¯•APIæ–‡æ¡£
curl http://localhost:3000/api
```

### 3. è®¿é—®å‰ç«¯é¡µé¢
- ç®¡ç†åå°: http://localhost:3001
- å°ç¨‹åºå‰ç«¯: http://localhost:3002

### 4. ç™»å½•æµ‹è¯•
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin2025`

## âš ï¸ å¸¸è§é—®é¢˜

### Node.js ç‰ˆæœ¬é—®é¢˜
```bash
# æ£€æŸ¥ç‰ˆæœ¬
node --version  # éœ€è¦ >= 18.18.0

# ä½¿ç”¨ nvm å‡çº§
nvm install 20 && nvm use 20 && nvm alias default 20
```

### ç«¯å£å†²çª
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./ser.sh stop all

# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000
lsof -i :3001
lsof -i :3002

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥MySQLæœåŠ¡
systemctl status mysql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u root -p -h localhost -P 3306 logistics_db
```

### ä¾èµ–å®‰è£…é—®é¢˜
```bash
# æ¸…ç†é‡æ–°å®‰è£…
cd ç›®æ ‡ç›®å½•
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

### æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la ser.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x ser.sh

# æ£€æŸ¥ç›®å½•æƒé™
chmod -R 755 logs/
chmod -R 755 pids/
chmod -R 755 uploads/
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç›‘æ§
```bash
# ç›‘æ§é”™è¯¯æ—¥å¿—
tail -f logs/backend.log | grep ERROR

# ç›‘æ§è®¿é—®æ—¥å¿—
tail -f logs/backend.log | grep "HTTP"
```

### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
top
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### å®šæœŸç»´æŠ¤
```bash
# æ¸…ç†æ—§æ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
find logs/ -name "*.log" -mtime +7 -delete

# æ¸…ç†æ—§çš„ä¸Šä¼ æ–‡ä»¶ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼‰
find uploads/ -name "*.jpg" -mtime +90 -delete
```

---

**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹ [æœåŠ¡ç®¡ç†è„šæœ¬](./service-management.md) äº†è§£è¯¦ç»†çš„æœåŠ¡ç®¡ç†æ“ä½œã€‚
