# å“åº”æ ¼å¼ç»Ÿä¸€ä¼˜åŒ–æ€»ç»“

## ğŸ‰ ä¼˜åŒ–å®Œæˆ

âœ… **å“åº”æ ¼å¼ç»Ÿä¸€ä¼˜åŒ–å·²æˆåŠŸå®Œæˆï¼**

## ğŸ“‹ ä¼˜åŒ–å†…å®¹

### 1. âœ… å¼ºåˆ¶ä½¿ç”¨ResponseUtilå·¥å…·ç±»

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `src/common/health.controller.ts` - å¥åº·æ£€æŸ¥æ¥å£
- `src/common/upload.controller.ts` - æ–‡ä»¶ä¸Šä¼ æ¥å£
- `src/common/test-exception.controller.ts` - å¼‚å¸¸æµ‹è¯•æ¥å£

**ä¼˜åŒ–å‰ï¼š**
```typescript
// æ‰‹åŠ¨æ„é€ å“åº”
return {
  status: 'ok',
  timestamp: new Date().toISOString(),
  message: 'ç‰©æµé…é€ç®¡ç†ç³»ç»Ÿè¿è¡Œæ­£å¸¸',
  version: '1.0.0',
};
```

**ä¼˜åŒ–åï¼š**
```typescript
// ä½¿ç”¨ResponseUtilç»Ÿä¸€æ ¼å¼
return ResponseUtil.success({
  status: 'ok',
  message: 'ç‰©æµé…é€ç®¡ç†ç³»ç»Ÿè¿è¡Œæ­£å¸¸',
  version: '1.0.0',
}, 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸');
```

### 2. âœ… ä¿®å¤åˆ†é¡µå“åº”æ ¼å¼

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `src/customers/customers.controller.ts` - å®¢æˆ·ç®¡ç†åˆ†é¡µ
- `src/users/users.controller.ts` - ç”¨æˆ·ç®¡ç†åˆ†é¡µ
- `src/roles/roles.controller.ts` - è§’è‰²ç®¡ç†åˆ†é¡µ
- `src/wx-users/wx-users.controller.ts` - å°ç¨‹åºç”¨æˆ·åˆ†é¡µ
- `src/receipts/receipts.controller.ts` - ç­¾æ”¶å•åˆ†é¡µ

**ä¼˜åŒ–å‰ï¼š**
```typescript
// æ‰‹åŠ¨æ„é€ åˆ†é¡µå“åº”
return {
  code: RESPONSE_CODES.SUCCESS,
  message: 'è·å–æˆåŠŸ',
  data: {
    list: result.data,
    total: result.total,
    page: result.page,
    limit: result.limit,
    totalPages: result.totalPages,
  }
};
```

**ä¼˜åŒ–åï¼š**
```typescript
// ä½¿ç”¨ResponseUtil.page()ç»Ÿä¸€æ ¼å¼
return ResponseUtil.page(
  result.data,
  result.total,
  result.page,
  result.limit,
  'è·å–æˆåŠŸ'
);
```

### 3. âœ… æ¸…ç†åºŸå¼ƒçš„pageOldæ–¹æ³•

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `src/common/utils/response.util.ts`

**ä¼˜åŒ–å†…å®¹ï¼š**
- å®Œå…¨ç§»é™¤äº†å·²åºŸå¼ƒçš„`pageOld`æ–¹æ³•
- å¼ºåˆ¶æ‰€æœ‰åˆ†é¡µå“åº”ä½¿ç”¨æ ‡å‡†çš„`page`æ–¹æ³•
- ç¡®ä¿åˆ†é¡µæ ¼å¼å®Œå…¨ç»Ÿä¸€

### 4. âœ… ç»Ÿä¸€æ—¶é—´æˆ³æ ¼å¼

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `src/tasks/tasks.service.ts`

**ä¼˜åŒ–å‰ï¼š**
```typescript
currentTime: new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' })
```

**ä¼˜åŒ–åï¼š**
```typescript
currentTime: new Date().toISOString()
```

## ğŸ“Š ç»Ÿä¸€åçš„å“åº”æ ¼å¼

### æˆåŠŸå“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { /* å®é™…æ•°æ® */ },
  "timestamp": "2025-07-11T03:15:42.123Z"
}
```

### åˆ†é¡µå“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "list": [ /* æ•°æ®åˆ—è¡¨ */ ],
    "total": 100,
    "page": 1,
    "limit": 10,
    "totalPages": 10
  },
  "timestamp": "2025-07-11T03:15:42.123Z"
}
```

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "code": 403,
  "message": "å‚æ•°é”™è¯¯",
  "data": null,
  "timestamp": "2025-07-11T03:15:42.123Z"
}
```

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### ä¼˜åŒ–å‰çš„é—®é¢˜
- âŒ å“åº”æ ¼å¼ä¸ç»Ÿä¸€ï¼Œæœ‰äº›ä½¿ç”¨ResponseUtilï¼Œæœ‰äº›æ‰‹åŠ¨æ„é€ 
- âŒ åˆ†é¡µæ ¼å¼å­˜åœ¨æ–°æ—§ä¸¤ç§ï¼ˆpageOldå·²åºŸå¼ƒä½†ä»å­˜åœ¨ï¼‰
- âŒ æ—¶é—´æˆ³æ ¼å¼ä¸ä¸€è‡´ï¼ˆISOæ ¼å¼ vs æœ¬åœ°åŒ–æ ¼å¼ï¼‰
- âŒ ç¼ºå°‘ç»Ÿä¸€çš„å“åº”ç»“æ„

### ä¼˜åŒ–åçš„æ•ˆæœ
- âœ… æ‰€æœ‰å“åº”éƒ½ä½¿ç”¨ResponseUtilå·¥å…·ç±»
- âœ… åˆ†é¡µæ ¼å¼å®Œå…¨ç»Ÿä¸€ï¼ŒåºŸå¼ƒæ–¹æ³•å·²æ¸…ç†
- âœ… æ—¶é—´æˆ³æ ¼å¼ç»Ÿä¸€ä½¿ç”¨ISOæ ¼å¼
- âœ… å“åº”ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œä¾¿äºå‰ç«¯å¤„ç†

## ğŸ“ˆ ç»Ÿè®¡æ•°æ®

| ä¼˜åŒ–é¡¹ç›® | ä¿®æ”¹æ–‡ä»¶æ•° | ä¿®æ”¹æ–¹æ³•æ•° | çŠ¶æ€ |
|---------|-----------|-----------|------|
| å¼ºåˆ¶ä½¿ç”¨ResponseUtil | 3 | 5 | âœ… |
| ä¿®å¤åˆ†é¡µå“åº”æ ¼å¼ | 5 | 6 | âœ… |
| æ¸…ç†åºŸå¼ƒæ–¹æ³• | 1 | 1 | âœ… |
| ç»Ÿä¸€æ—¶é—´æˆ³æ ¼å¼ | 1 | 1 | âœ… |
| **æ€»è®¡** | **10** | **13** | **âœ…** |

## ğŸ” éªŒè¯æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡æµ‹è¯•
```bash
cd backend-node && npm run start:dev
```

### 2. æµ‹è¯•å„ç§å“åº”æ ¼å¼
```bash
# æµ‹è¯•æ­£å¸¸å“åº”
curl http://localhost:3000/api/health

# æµ‹è¯•åˆ†é¡µå“åº”
curl http://localhost:3000/api/users

# æµ‹è¯•æ–‡ä»¶ä¸Šä¼ å“åº”
curl -X POST -F "file=@test.jpg" http://localhost:3000/api/upload/image
```

### 3. æ£€æŸ¥å“åº”æ ¼å¼ä¸€è‡´æ€§
æ‰€æœ‰å“åº”éƒ½åº”è¯¥åŒ…å«ï¼š
- `code`: å“åº”çŠ¶æ€ç 
- `message`: å“åº”æ¶ˆæ¯
- `data`: å“åº”æ•°æ®
- `timestamp`: ISOæ ¼å¼æ—¶é—´æˆ³

## ğŸš€ åç»­å»ºè®®

1. **ä»£ç å®¡æŸ¥**ï¼šåœ¨ä»£ç å®¡æŸ¥æ—¶ç¡®ä¿æ–°å¢æ¥å£éƒ½ä½¿ç”¨ResponseUtil
2. **ESLintè§„åˆ™**ï¼šå¯ä»¥è€ƒè™‘æ·»åŠ ESLintè§„åˆ™ç¦æ­¢æ‰‹åŠ¨æ„é€ å“åº”å¯¹è±¡
3. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°APIæ–‡æ¡£ï¼Œç¡®ä¿ç¤ºä¾‹éƒ½ä½¿ç”¨ç»Ÿä¸€æ ¼å¼
4. **å‰ç«¯é€‚é…**ï¼šé€šçŸ¥å‰ç«¯å›¢é˜Ÿå“åº”æ ¼å¼å·²ç»Ÿä¸€ï¼Œå¯ä»¥ç®€åŒ–å¤„ç†é€»è¾‘

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ResponseUtilå·¥å…·ç±»æ–‡æ¡£](./response.util.ts)
- [å“åº”ç è§„èŒƒæ–‡æ¡£](../constants/README.md)
- [åˆ†é¡µå“åº”æ ¼å¼è§„èŒƒ](../../../docs/05-APIè§„èŒƒ/åˆ†é¡µå“åº”æ ¼å¼è§„èŒƒ.md)

---

**ğŸŠ ç¬¬äºŒä¸ªä¼˜åŒ–é¡¹ç›®å®Œæˆï¼å“åº”æ ¼å¼å·²å®Œå…¨ç»Ÿä¸€ï¼Œç³»ç»Ÿçš„APIä¸€è‡´æ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚**
