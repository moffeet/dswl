# å¤–éƒ¨ç³»ç»Ÿæ•°æ®åŒæ­¥è¯´æ˜

## æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†ä¸å¤–éƒ¨ERPç³»ç»Ÿçš„å®¢æˆ·æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚å¤–éƒ¨ç³»ç»ŸåªåŒ…å«**å®¢æˆ·IDã€å®¢æˆ·åç§°å’Œé—¨åº—åœ°å€**ä¸‰ä¸ªå­—æ®µã€‚åŒæ­¥é‡‡ç”¨æ¨¡æ‹Ÿæ•°æ®çš„æ–¹å¼ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„å¤–éƒ¨ç³»ç»ŸAPIè°ƒç”¨ã€‚

## åŒæ­¥è§„åˆ™

### æ•°æ®åŒ¹é…è§„åˆ™
- **åŒ¹é…åŸºå‡†**: ä»¥å®¢æˆ·IDä¸ºåŸºå‡†è¿›è¡Œæ•°æ®åŒ¹é…
- **æ–°å®¢æˆ·**: å¤–éƒ¨ç³»ç»Ÿä¸­å­˜åœ¨ä½†æœ¬ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„å®¢æˆ·å°†è¢«åˆ›å»º
- **ç°æœ‰å®¢æˆ·**: æ ¹æ®å®¢æˆ·IDåŒ¹é…ï¼Œæ›´æ–°ç›¸åº”å­—æ®µ

### å­—æ®µåŒæ­¥ç­–ç•¥

#### ğŸ†• æ–°å®¢æˆ·ï¼ˆå¤–éƒ¨ç³»ç»Ÿæœ‰ï¼Œæœ¬ç³»ç»Ÿæ²¡æœ‰ï¼‰
- âœ… å®¢æˆ·åç§° (customerName) - æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿ
- âœ… é—¨åº—åœ°å€ (storeAddress) - æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿ
- âœ… é—¨åº—ç»çº¬åº¦ (storeLongitude, storeLatitude) - é€šè¿‡é«˜å¾·APIè‡ªåŠ¨è®¡ç®—
- ğŸ”§ å®¢æˆ·ç¼–å· (customerNumber) - ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ
- ğŸ”§ å®¢æˆ·çŠ¶æ€ (status) - é»˜è®¤ä¸º active

#### ğŸ”„ ç°æœ‰å®¢æˆ·ï¼ˆä¸¤ä¸ªç³»ç»Ÿéƒ½æœ‰ï¼‰
- âœ… å®¢æˆ·åç§° (customerName) - ä»¥å¤–éƒ¨ç³»ç»Ÿä¸ºå‡†
- ğŸ”’ é—¨åº—åœ°å€ (storeAddress) - ä»¥å½“å‰ç³»ç»Ÿä¸ºå‡†ï¼ˆä¸åŒæ­¥ï¼‰
- ğŸ”’ é—¨åº—ç»çº¬åº¦ (storeLongitude, storeLatitude) - ä»¥å½“å‰ç³»ç»Ÿä¸ºå‡†ï¼ˆä¸åŒæ­¥ï¼‰

#### ğŸ”’ å§‹ç»ˆä¸åŒæ­¥çš„å­—æ®µï¼ˆä»¥å½“å‰ç³»ç»Ÿä¸ºå‡†ï¼‰
- ä»“åº“åœ°å€ (warehouseAddress)
- ä»“åº“ç»çº¬åº¦ (warehouseLongitude, warehouseLatitude)
- æ›´æ–°äºº (updateBy)
- åˆ›å»ºæ—¶é—´ (createdAt)
- æ›´æ–°æ—¶é—´ (updatedAt)

## æ¨¡æ‹Ÿæ•°æ®ç»“æ„

### å¤–éƒ¨ç³»ç»Ÿå®¢æˆ·æ•°æ®
```json
{
  "syncMetadata": {
    "lastSyncTime": "2024-01-15T08:30:00Z",
    "syncVersion": "v1.2.0",
    "totalCustomers": 6,
    "dataSource": "å¤–éƒ¨ERPç³»ç»Ÿ",
    "syncStatus": "completed",
    "nextScheduledSync": "2024-01-16T08:30:00Z"
  },
  "customers": [
    {
      "id": 1,
      "customerName": "æ·±åœ³å¸‚è…¾è®¯ç§‘æŠ€æœ‰é™å…¬å¸",
      "storeAddress": "æ·±åœ³å¸‚å—å±±åŒºç²¤æµ·è¡—é“ç§‘æŠ€å›­å—åŒºè…¾è®¯æ»¨æµ·å¤§å¦1-3å±‚"
    },
    {
      "id": 2,
      "customerName": "é˜¿é‡Œå·´å·´ï¼ˆä¸­å›½ï¼‰æœ‰é™å…¬å¸",
      "storeAddress": "æµ™æ±Ÿçœæ­å·å¸‚ä½™æ­åŒºæ–‡ä¸€è¥¿è·¯969å·é˜¿é‡Œå·´å·´è¥¿æºªå›­åŒº"
    }
  ]
}
```

### æ•°æ®å­—æ®µè¯´æ˜
- **id**: å®¢æˆ·IDï¼Œç”¨äºåŒ¹é…ç°æœ‰å®¢æˆ·
- **customerName**: å®¢æˆ·åç§°ï¼Œä¼šåŒæ­¥åˆ°æœ¬ç³»ç»Ÿ
- **storeAddress**: é—¨åº—åœ°å€ï¼Œä¼šåŒæ­¥åˆ°æœ¬ç³»ç»Ÿ

## APIæ¥å£

### 1. æ‰§è¡ŒåŒæ­¥
```
POST /api/customers/sync
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "åŒæ­¥å®Œæˆï¼šå¤„ç† 6 ä¸ªå®¢æˆ·ï¼Œåˆ›å»º 1 ä¸ªï¼Œæ›´æ–° 5 ä¸ªï¼Œè·³è¿‡ 0 ä¸ª",
  "data": {
    "success": true,
    "syncedCount": 6,
    "createdCount": 1,
    "updatedCount": 5,
    "skippedCount": 0,
    "lastSyncTime": "2024-01-15T08:30:00Z"
  }
}
```

### 2. è·å–åŒæ­¥å…ƒæ•°æ®
```
GET /api/customers/sync-metadata
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "lastSyncTime": "2024-01-15T08:30:00Z",
    "syncVersion": "v1.2.0",
    "totalCustomers": 6,
    "dataSource": "å¤–éƒ¨ERPç³»ç»Ÿ",
    "syncStatus": "completed",
    "nextScheduledSync": "2024-01-16T08:30:00Z"
  }
}
```

## ä½¿ç”¨æ–¹æ³•

### åç«¯
1. ç¡®ä¿æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œï¼Œæ·»åŠ äº†æ–°çš„å®¢æˆ·å­—æ®µ
2. å¯åŠ¨åç«¯æœåŠ¡
3. è°ƒç”¨åŒæ­¥APIæˆ–ä½¿ç”¨å‰ç«¯ç•Œé¢

### å‰ç«¯
1. åœ¨å®¢æˆ·ç®¡ç†é¡µé¢ç‚¹å‡»"åŒæ­¥æ•°æ®"æŒ‰é’®
2. æŸ¥çœ‹åŒæ­¥çŠ¶æ€å’Œç»“æœ
3. åŒæ­¥å®Œæˆåå®¢æˆ·åˆ—è¡¨ä¼šè‡ªåŠ¨åˆ·æ–°

## æ‰©å±•è¯´æ˜

### æ›¿æ¢ä¸ºçœŸå®å¤–éƒ¨ç³»ç»Ÿ
è¦æ›¿æ¢ä¸ºçœŸå®çš„å¤–éƒ¨ç³»ç»Ÿï¼Œéœ€è¦ä¿®æ”¹ `CustomerSyncService` ä¸­çš„ `loadExternalSystemData()` æ–¹æ³•ï¼š

```typescript
private async loadExternalSystemData(): Promise<any> {
  // æ›¿æ¢ä¸ºçœŸå®çš„å¤–éƒ¨ç³»ç»ŸAPIè°ƒç”¨
  const response = await fetch('https://external-system-api.com/customers');
  return await response.json();
}
```

### å®šæ—¶åŒæ­¥
å¯ä»¥ä½¿ç”¨NestJSçš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½å®ç°è‡ªåŠ¨åŒæ­¥ï¼š

```typescript
import { Cron, CronExpression } from '@nestjs/schedule';

@Cron(CronExpression.EVERY_DAY_AT_2AM)
async scheduledSync() {
  await this.syncFromExternalSystem();
}
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**: åŒæ­¥å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®
2. **æƒé™æ§åˆ¶**: ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥æ‰§è¡ŒåŒæ­¥æ“ä½œ
3. **é”™è¯¯å¤„ç†**: åŒæ­¥è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¼šè¢«è®°å½•ï¼Œä½†ä¸ä¼šä¸­æ–­æ•´ä¸ªåŒæ­¥æµç¨‹
4. **æ€§èƒ½è€ƒè™‘**: å¤§é‡æ•°æ®åŒæ­¥æ—¶å»ºè®®åˆ†æ‰¹å¤„ç†
5. **æ•°æ®ä¸€è‡´æ€§**: åŒæ­¥è¿‡ç¨‹ä¸­é¿å…æ‰‹åŠ¨ä¿®æ”¹å®¢æˆ·æ•°æ®
