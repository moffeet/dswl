# å¯†ç ä¿®æ”¹æ¥å£è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†æé«˜ç³»ç»Ÿå®‰å…¨æ€§å’Œç®€åŒ–ç»´æŠ¤ï¼Œæˆ‘ä»¬é‡‡ç”¨**ç»Ÿä¸€çš„å¯†ç ä¿®æ”¹æ¥å£**ï¼Œé€‚ç”¨äºæ‰€æœ‰å¯†ç ä¿®æ”¹åœºæ™¯ã€‚

## ğŸ”— æ¥å£è¯¦æƒ…

### ç»Ÿä¸€å¯†ç ä¿®æ”¹æ¥å£

**æ¥å£è·¯å¾„ï¼š** `POST /api/auth/update-password`

**ä½¿ç”¨åœºæ™¯ï¼š**
- **é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç **ï¼šç”¨æˆ·é¦–æ¬¡ç™»å½•åä¿®æ”¹é»˜è®¤å¯†ç 
- **ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç **ï¼šç”¨æˆ·åœ¨ä¸ªäººè®¾ç½®ä¸­ä¿®æ”¹å¯†ç 
- **å®šæœŸæ›´æ¢å¯†ç **ï¼šå®‰å…¨éœ€æ±‚çš„å®šæœŸæ›´æ¢
- **å¯†ç æ³„éœ²å¤„ç†**ï¼šæ€€ç–‘å¯†ç æ³„éœ²æ—¶çš„ä¸»åŠ¨æ›´æ¢

**å®‰å…¨ç‰¹æ€§ï¼š**
- âœ… **å¿…é¡»**éªŒè¯åŸå¯†ç ï¼ˆç»Ÿä¸€å®‰å…¨æ ‡å‡†ï¼Œæ— å®‰å…¨æ¼æ´ï¼‰
- âœ… éœ€è¦JWT tokenè®¤è¯ï¼ˆç¡®ä¿ç”¨æˆ·å·²ç™»å½•ï¼‰
- âœ… æ”¯æŒåŠ å¯†ä¼ è¾“ï¼ˆé˜²æ­¢ç½‘ç»œçªƒå¬ï¼‰
- âœ… å¯†ç æ ¼å¼éªŒè¯ï¼ˆè‹±æ–‡+æ•°å­—ï¼Œ6-12ä½ï¼‰
- âœ… é˜²æ­¢æ–°æ—§å¯†ç ç›¸åŒ

**è¯·æ±‚å‚æ•°ï¼š**
```typescript
{
  oldPassword: string;      // åŸå¯†ç ï¼ˆå¯èƒ½æ˜¯åŠ å¯†çš„ï¼‰
  newPassword: string;      // æ–°å¯†ç ï¼ˆå¯èƒ½æ˜¯åŠ å¯†çš„ï¼‰
}
```

**å‰ç«¯é¡µé¢ï¼š** å¯¼èˆªæ ä¿®æ”¹å¯†ç åŠŸèƒ½

## ğŸ›¡ï¸ å®‰å…¨ä¼˜åŠ¿

### ç»Ÿä¸€å®‰å…¨æ ‡å‡†
- **æ— å®‰å…¨æ¼æ´**ï¼šæ‰€æœ‰å¯†ç ä¿®æ”¹éƒ½éœ€è¦éªŒè¯åŸå¯†ç 
- **ç»Ÿä¸€è®¤è¯**ï¼šéƒ½éœ€è¦JWT tokenè®¤è¯
- **åŠ å¯†ä¼ è¾“**ï¼šæ”¯æŒå¯†ç åŠ å¯†ä¼ è¾“
- **æ ¼å¼éªŒè¯**ï¼šç»Ÿä¸€çš„å¯†ç æ ¼å¼è¦æ±‚

### è®¾è®¡ä¼˜åŠ¿
- **ç®€åŒ–ç»´æŠ¤**ï¼šåªéœ€è¦ç»´æŠ¤ä¸€ä¸ªæ¥å£
- **ç»Ÿä¸€ä½“éªŒ**ï¼šç”¨æˆ·ä½“éªŒä¸€è‡´
- **å®‰å…¨å¯é **ï¼šæ— è®¤è¯ç»•è¿‡é£é™©

## ğŸ¯ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·é¦–æ¬¡ç™»å½• admin/admin] --> B[ç™»å½•æˆåŠŸï¼Œè·å¾—JWT]
    B --> C[ç³»ç»Ÿæç¤ºå»ºè®®ä¿®æ”¹å¯†ç ]
    C --> D[ç”¨æˆ·ç‚¹å‡»å¯¼èˆªæ ä¿®æ”¹å¯†ç ]
    D --> E[è¾“å…¥åŸå¯†ç adminå’Œæ–°å¯†ç ]
    E --> F[è°ƒç”¨ /auth/update-password]
    F --> G[éªŒè¯åŸå¯†ç ï¼Œä¿®æ”¹æˆåŠŸ]
```

### ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç æµç¨‹
```mermaid
graph TD
    A[å·²ç™»å½•ç”¨æˆ·] --> B[ç‚¹å‡»å¯¼èˆªæ ä¿®æ”¹å¯†ç ]
    B --> C[è¾“å…¥åŸå¯†ç å’Œæ–°å¯†ç ]
    C --> D[è°ƒç”¨ /auth/update-password]
    D --> E{éªŒè¯åŸå¯†ç }
    E -->|æˆåŠŸ| F[ä¿®æ”¹æˆåŠŸ]
    E -->|å¤±è´¥| G[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### åç«¯æ–‡ä»¶
```
backend-node/src/auth/
â”œâ”€â”€ auth.controller.ts     # ç»Ÿä¸€å¯†ç ä¿®æ”¹æ¥å£
â”œâ”€â”€ auth.service.ts        # å¯†ç ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
â””â”€â”€ utils/crypto.util.ts   # å¯†ç åŠ å¯†è§£å¯†å·¥å…·
```

### å‰ç«¯æ–‡ä»¶
```
admin-frontend/src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ login/page.tsx     # ç™»å½•é¡µé¢ï¼ˆé¦–æ¬¡ç™»å½•æç¤ºï¼‰
â””â”€â”€ components/
    â””â”€â”€ Navigation.tsx     # å¯¼èˆªæ ï¼ˆç»Ÿä¸€å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼‰
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å¯†ç éªŒè¯é€»è¾‘
```typescript
// é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç ï¼ˆAuthService.changePasswordï¼‰
async changePassword(userId: number, newPassword: string): Promise<void> {
  // ä¸éªŒè¯åŸå¯†ç ï¼Œç›´æ¥æ›´æ–°
  await this.usersService.changePassword(userId, newPassword);
}

// ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç ï¼ˆAuthService.updatePasswordï¼‰
async updatePassword(userId: number, oldPassword: string, newPassword: string): Promise<void> {
  // 1. éªŒè¯åŸå¯†ç 
  const isOldPasswordValid = await bcrypt.compare(oldPassword, user.password);
  
  // 2. éªŒè¯æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ
  const isSamePassword = await bcrypt.compare(newPassword, user.password);
  
  // 3. æ›´æ–°å¯†ç 
  await this.usersService.changePassword(userId, newPassword);
}
```

### å‰ç«¯åŠ å¯†ä¼ è¾“
```typescript
// ä¸¤ä¸ªæ¥å£éƒ½æ”¯æŒç›¸åŒçš„åŠ å¯†æ–¹å¼ï¼ˆåªéœ€è¦åŠ å¯†ï¼Œæ— éœ€ç­¾åéªŒè¯ï¼‰
const secureData = createSecureLoginData('', password);
const requestData = {
  password: secureData.password    // åŠ å¯†åçš„å¯†ç 
};

// ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç ç¤ºä¾‹
const secureOldData = createSecureLoginData('', oldPassword);
const secureNewData = createSecureLoginData('', newPassword);
const updateRequestData = {
  oldPassword: secureOldData.password,  // åŠ å¯†åçš„åŸå¯†ç 
  newPassword: secureNewData.password  // åŠ å¯†åçš„æ–°å¯†ç 
};
```

## ğŸ“ APIå“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ",
  "data": null
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 401,
  "message": "åŸå¯†ç é”™è¯¯",
  "data": null
}
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

1. **åç«¯éƒ¨ç½²**ï¼šæ— éœ€é¢å¤–é…ç½®ï¼Œæ¥å£å·²é›†æˆåˆ°ç°æœ‰è®¤è¯æ¨¡å—
2. **å‰ç«¯éƒ¨ç½²**ï¼šæ–°å¢é¡µé¢ä¼šè‡ªåŠ¨åŒ…å«åœ¨æ„å»ºä¸­
3. **æ•°æ®åº“**ï¼šæ— éœ€ä¿®æ”¹æ•°æ®åº“ç»“æ„
4. **å…¼å®¹æ€§**ï¼šå‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

## âœ… æµ‹è¯•å»ºè®®

### é¦–æ¬¡ç™»å½•ä¿®æ”¹å¯†ç æµ‹è¯•
1. åˆ›å»ºæ–°ç”¨æˆ·
2. ä½¿ç”¨é»˜è®¤å¯†ç ç™»å½•
3. éªŒè¯æ˜¯å¦è·³è½¬åˆ°ä¿®æ”¹å¯†ç é¡µé¢
4. æµ‹è¯•å¯†ç æ ¼å¼éªŒè¯
5. æµ‹è¯•ä¿®æ”¹æˆåŠŸåçš„ç™»å½•

### ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç æµ‹è¯•
1. æ­£å¸¸ç™»å½•ç”¨æˆ·
2. è®¿é—®ä¿®æ”¹å¯†ç é¡µé¢
3. æµ‹è¯•åŸå¯†ç éªŒè¯
4. æµ‹è¯•æ–°å¯†ç æ ¼å¼éªŒè¯
5. æµ‹è¯•ä¿®æ”¹æˆåŠŸåéœ€è¦é‡æ–°ç™»å½•

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **å¯†ç å¼ºåº¦æ£€æµ‹**ï¼šå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„å¯†ç å¼ºåº¦è¦æ±‚
2. **å¯†ç å†å²è®°å½•**ï¼šé˜²æ­¢ä½¿ç”¨æœ€è¿‘ä½¿ç”¨è¿‡çš„å¯†ç 
3. **ä¿®æ”¹é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢é¢‘ç¹ä¿®æ”¹å¯†ç 
4. **é‚®ä»¶é€šçŸ¥**ï¼šå¯†ç ä¿®æ”¹åå‘é€é‚®ä»¶é€šçŸ¥
5. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•å¯†ç ä¿®æ”¹æ“ä½œçš„è¯¦ç»†æ—¥å¿—
