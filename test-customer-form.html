<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户表单测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            height: 60px;
            resize: vertical;
        }
        .address-section {
            background: #f7f8fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .address-section h4 {
            margin: 0 0 15px 0;
            color: #1D2129;
            font-size: 14px;
        }
        .coordinates-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .coordinates-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }
        .btn-outline {
            background: white;
            color: #1890ff;
            border-color: #1890ff;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .readonly {
            background-color: #f5f5f5;
            color: #666;
        }
        .success {
            color: #52c41a;
            font-size: 12px;
            margin-top: 5px;
        }
        .error {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>客户信息编辑 - 地址管理功能测试</h2>
        
        <div class="form-group">
            <label>客户名 *</label>
            <input type="text" id="customerName" placeholder="请输入客户名" value="测试客户">
        </div>

        <!-- 门店地址区域 -->
        <div class="address-section">
            <h4>门店地址</h4>
            <div class="form-group">
                <label>门店地址</label>
                <textarea id="storeAddress" placeholder="请输入门店地址（遵循省市区/城镇格式）">广东省深圳市南山区科技园</textarea>
            </div>
            <div class="coordinates-row">
                <div class="form-group">
                    <label>门店经度</label>
                    <input type="text" id="storeLongitude" placeholder="经度（经度在前）" readonly class="readonly">
                </div>
                <div class="form-group">
                    <label>门店纬度</label>
                    <input type="text" id="storeLatitude" placeholder="纬度（纬度在后）" readonly class="readonly">
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-outline" onclick="geocodeStore()">获取经纬度</button>
                <button class="btn btn-outline" onclick="reverseGeocodeStore()">获取地址</button>
                <button class="btn" id="storeEditBtn" onclick="toggleStoreEdit()">修正经纬度</button>
            </div>
            <div id="storeMessage"></div>
        </div>

        <!-- 仓库地址区域 -->
        <div class="address-section">
            <h4>仓库地址</h4>
            <div class="form-group">
                <label>仓库地址</label>
                <textarea id="warehouseAddress" placeholder="请输入仓库地址（遵循省市区/城镇格式）">广东省深圳市宝安区物流园</textarea>
            </div>
            <div class="coordinates-row">
                <div class="form-group">
                    <label>仓库经度</label>
                    <input type="text" id="warehouseLongitude" placeholder="经度（经度在前）" readonly class="readonly">
                </div>
                <div class="form-group">
                    <label>仓库纬度</label>
                    <input type="text" id="warehouseLatitude" placeholder="纬度（纬度在后）" readonly class="readonly">
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-outline" onclick="geocodeWarehouse()">获取经纬度</button>
                <button class="btn btn-outline" onclick="reverseGeocodeWarehouse()">获取地址</button>
                <button class="btn" id="warehouseEditBtn" onclick="toggleWarehouseEdit()">修正经纬度</button>
            </div>
            <div id="warehouseMessage"></div>
        </div>

        <div class="form-group">
            <label>客户地址（旧字段）</label>
            <textarea id="customerAddress" placeholder="请输入客户地址">广东省深圳市南山区</textarea>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" onclick="saveCustomer()">保存客户</button>
            <button class="btn" onclick="resetForm()">重置</button>
        </div>
    </div>

    <script>
        let storeEditable = false;
        let warehouseEditable = false;

        function toggleStoreEdit() {
            storeEditable = !storeEditable;
            const lonInput = document.getElementById('storeLongitude');
            const latInput = document.getElementById('storeLatitude');
            const btn = document.getElementById('storeEditBtn');
            
            if (storeEditable) {
                lonInput.readOnly = false;
                latInput.readOnly = false;
                lonInput.classList.remove('readonly');
                latInput.classList.remove('readonly');
                btn.textContent = '锁定经纬度';
                btn.classList.add('btn-primary');
            } else {
                lonInput.readOnly = true;
                latInput.readOnly = true;
                lonInput.classList.add('readonly');
                latInput.classList.add('readonly');
                btn.textContent = '修正经纬度';
                btn.classList.remove('btn-primary');
            }
        }

        function toggleWarehouseEdit() {
            warehouseEditable = !warehouseEditable;
            const lonInput = document.getElementById('warehouseLongitude');
            const latInput = document.getElementById('warehouseLatitude');
            const btn = document.getElementById('warehouseEditBtn');
            
            if (warehouseEditable) {
                lonInput.readOnly = false;
                latInput.readOnly = false;
                lonInput.classList.remove('readonly');
                latInput.classList.remove('readonly');
                btn.textContent = '锁定经纬度';
                btn.classList.add('btn-primary');
            } else {
                lonInput.readOnly = true;
                latInput.readOnly = true;
                lonInput.classList.add('readonly');
                latInput.classList.add('readonly');
                btn.textContent = '修正经纬度';
                btn.classList.remove('btn-primary');
            }
        }

        async function geocodeStore() {
            const address = document.getElementById('storeAddress').value;
            if (!address) {
                showMessage('storeMessage', '请先输入门店地址', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/customers/geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ address })
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    document.getElementById('storeLongitude').value = result.data.longitude;
                    document.getElementById('storeLatitude').value = result.data.latitude;
                    showMessage('storeMessage', '获取经纬度成功', 'success');
                } else {
                    showMessage('storeMessage', result.message || '获取经纬度失败', 'error');
                }
            } catch (error) {
                showMessage('storeMessage', '获取经纬度失败', 'error');
            }
        }

        async function reverseGeocodeStore() {
            const longitude = document.getElementById('storeLongitude').value;
            const latitude = document.getElementById('storeLatitude').value;
            
            if (!longitude || !latitude) {
                showMessage('storeMessage', '请先输入经纬度', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/customers/reverse-geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ longitude, latitude })
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    document.getElementById('storeAddress').value = result.data.address;
                    showMessage('storeMessage', '获取地址成功', 'success');
                } else {
                    showMessage('storeMessage', result.message || '获取地址失败', 'error');
                }
            } catch (error) {
                showMessage('storeMessage', '获取地址失败', 'error');
            }
        }

        async function geocodeWarehouse() {
            const address = document.getElementById('warehouseAddress').value;
            if (!address) {
                showMessage('warehouseMessage', '请先输入仓库地址', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/customers/geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ address })
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    document.getElementById('warehouseLongitude').value = result.data.longitude;
                    document.getElementById('warehouseLatitude').value = result.data.latitude;
                    showMessage('warehouseMessage', '获取经纬度成功', 'success');
                } else {
                    showMessage('warehouseMessage', result.message || '获取经纬度失败', 'error');
                }
            } catch (error) {
                showMessage('warehouseMessage', '获取经纬度失败', 'error');
            }
        }

        async function reverseGeocodeWarehouse() {
            const longitude = document.getElementById('warehouseLongitude').value;
            const latitude = document.getElementById('warehouseLatitude').value;
            
            if (!longitude || !latitude) {
                showMessage('warehouseMessage', '请先输入经纬度', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/customers/reverse-geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ longitude, latitude })
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    document.getElementById('warehouseAddress').value = result.data.address;
                    showMessage('warehouseMessage', '获取地址成功', 'success');
                } else {
                    showMessage('warehouseMessage', result.message || '获取地址失败', 'error');
                }
            } catch (error) {
                showMessage('warehouseMessage', '获取地址失败', 'error');
            }
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = type;
            setTimeout(() => {
                element.textContent = '';
                element.className = '';
            }, 3000);
        }

        function saveCustomer() {
            alert('保存功能演示 - 实际项目中会调用保存API');
        }

        function resetForm() {
            document.getElementById('customerName').value = '测试客户';
            document.getElementById('storeAddress').value = '广东省深圳市南山区科技园';
            document.getElementById('warehouseAddress').value = '广东省深圳市宝安区物流园';
            document.getElementById('customerAddress').value = '广东省深圳市南山区';
            document.getElementById('storeLongitude').value = '';
            document.getElementById('storeLatitude').value = '';
            document.getElementById('warehouseLongitude').value = '';
            document.getElementById('warehouseLatitude').value = '';
            
            // 重置编辑状态
            if (storeEditable) toggleStoreEdit();
            if (warehouseEditable) toggleWarehouseEdit();
        }
    </script>
</body>
</html>
